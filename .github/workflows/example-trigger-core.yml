# 这个文件应该放在 nursor-core2 仓库的 .github/workflows/ 目录下
# 当core项目创建tag时，会自动触发打包仓库的构建

name: Trigger Packaging Build

on:
  push:
    tags:
      - 'v*'

jobs:
  trigger-packaging:
    runs-on: ubuntu-latest
    steps:
      - name: Get tag name
        id: get_tag
        run: echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      
      - name: Trigger packaging repository build
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PACKAGING_REPO_TOKEN }}
          repository: nursor/nursor_install  # 你的打包仓库名称
          event-type: build-trigger
          client-payload: |
            {
              "version": "${{ steps.get_tag.outputs.tag }}",
              "flutter_ref": "${{ steps.get_tag.outputs.tag }}",
              "core_ref": "${{ steps.get_tag.outputs.tag }}",
              "triggered_by": "nursor-core2",
              "triggered_repo": "${{ github.repository }}"
            }

